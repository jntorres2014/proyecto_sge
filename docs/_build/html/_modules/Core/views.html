<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Core.views &#8212; documentación de Sge - 1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4848ba22" />
    <link rel="stylesheet" type="text/css" href="../../_static/pyramid.css?v=310c80ee" />
    <script src="../../_static/documentation_options.js?v=4936afed"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=efdbd0b9"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Sge - 1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Core.views</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Código fuente para Core.views</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseForbidden</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">Clases.models</span> <span class="kn">import</span> <span class="n">Inasistencias</span>
<span class="kn">from</span> <span class="nn">Core</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">Core.resource</span> <span class="kn">import</span> <span class="n">LocalidadResource</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Aula</span><span class="p">,</span> <span class="n">Calificacion</span><span class="p">,</span> <span class="n">Detalle_Horario</span><span class="p">,</span> <span class="n">Horario</span><span class="p">,</span> <span class="n">InscripcionDocente</span><span class="p">,</span> <span class="n">Instancia</span><span class="p">,</span> <span class="n">PlanDeEstudios</span><span class="p">,</span> <span class="n">Localidad</span><span class="p">,</span> <span class="n">Docente</span><span class="p">,</span><span class="n">Estudiante</span><span class="p">,</span><span class="n">EspacioCurricular</span><span class="p">,</span> <span class="n">AnioPlan</span><span class="p">,</span> <span class="n">Ciclo</span><span class="p">,</span> <span class="n">Persona</span><span class="p">,</span><span class="n">Inscripcion</span><span class="p">,</span> <span class="n">Division</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span><span class="n">TemplateView</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="kn">from</span> <span class="nn">tablib</span> <span class="kn">import</span> <span class="n">Dataset</span> 
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span> <span class="nn">tablib</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.pagesizes</span> <span class="kn">import</span> <span class="n">letter</span>
<span class="kn">from</span> <span class="nn">reportlab.platypus</span> <span class="kn">import</span> <span class="n">SimpleDocTemplate</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">TableStyle</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Estudiante</span><span class="p">,</span> <span class="n">Inscripcion</span>
<span class="kn">from</span> <span class="nn">reportlab.platypus</span> <span class="kn">import</span> <span class="n">SimpleDocTemplate</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Spacer</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">TableStyle</span>
<span class="kn">from</span> <span class="nn">reportlab.lib</span> <span class="kn">import</span> <span class="n">styles</span><span class="p">,</span><span class="n">colors</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.styles</span> <span class="kn">import</span> <span class="n">getSampleStyleSheet</span>
<span class="kn">from</span> <span class="nn">reportlab.lib.units</span> <span class="kn">import</span> <span class="n">inch</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="kn">from</span> <span class="nn">dal</span> <span class="kn">import</span> <span class="n">autocomplete</span>

<div class="viewcode-block" id="MateriaAutocomplete">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.MateriaAutocomplete">[documentos]</a>
<span class="k">class</span> <span class="nc">MateriaAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>
<div class="viewcode-block" id="MateriaAutocomplete.get_queryset">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.MateriaAutocomplete.get_queryset">[documentos]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idDiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forwarded</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;horario&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ebtre a materia autocomplete&quot;</span><span class="p">,</span> <span class="n">idDiv</span><span class="p">)</span>
        <span class="n">horario</span> <span class="o">=</span> <span class="n">Horario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">idDiv</span><span class="p">)</span>
        <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">horario</span><span class="o">.</span><span class="n">division</span><span class="o">.</span><span class="n">anio</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">anio</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anio</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span> <span class="o">=</span> <span class="n">anio</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>    
                <span class="n">Q</span><span class="p">(</span><span class="n">codigo__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span>           
        <span class="k">return</span> <span class="n">qs</span></div>
</div>


<div class="viewcode-block" id="DocenteHoraAutocomplete">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.DocenteHoraAutocomplete">[documentos]</a>
<span class="k">class</span> <span class="nc">DocenteHoraAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>
<div class="viewcode-block" id="DocenteHoraAutocomplete.get_queryset">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.DocenteHoraAutocomplete.get_queryset">[documentos]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idDiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forwarded</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;horario&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ebtre a materia autocomplete&quot;</span><span class="p">,</span> <span class="n">idDiv</span><span class="p">)</span>
        <span class="n">horario</span> <span class="o">=</span> <span class="n">Horario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">idDiv</span><span class="p">)</span>
        <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">horario</span><span class="o">.</span><span class="n">division</span><span class="o">.</span><span class="n">anio</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">anio</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anio</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">InscripcionDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span> <span class="o">=</span> <span class="n">anio</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">InscripcionDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">docentes</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inscripcion</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
            <span class="n">docentes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inscripcion</span><span class="o">.</span><span class="n">docente</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">docentes</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">docentes</span> <span class="o">=</span> <span class="n">docentes</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>    
                <span class="n">Q</span><span class="p">(</span><span class="n">apellido__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span>           
        <span class="k">return</span> <span class="n">docentes</span></div>
</div>




<div class="viewcode-block" id="LocalidadAutocomplete">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.LocalidadAutocomplete">[documentos]</a>
<span class="k">class</span> <span class="nc">LocalidadAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>

<div class="viewcode-block" id="LocalidadAutocomplete.get_queryset">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.LocalidadAutocomplete.get_queryset">[documentos]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">Localidad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>    
                <span class="n">Q</span><span class="p">(</span><span class="n">codigoPostal__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span>           
        <span class="k">return</span> <span class="n">qs</span></div>
</div>

<div class="viewcode-block" id="EstudianteAutocomplete">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.EstudianteAutocomplete">[documentos]</a>
<span class="k">class</span> <span class="nc">EstudianteAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>
<div class="viewcode-block" id="EstudianteAutocomplete.get_queryset">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.EstudianteAutocomplete.get_queryset">[documentos]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ENTRE A AUTOCOMPLETE******&#39;</span><span class="p">)</span>
        <span class="n">ciclo_actual</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Filtra los estudiantes que no están inscritos en el ciclo actual</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
            <span class="n">id__in</span><span class="o">=</span><span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo_actual</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;estudiante&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1">#qs = Estudiante.objects.all()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entreee&quot;</span><span class="p">,</span><span class="n">qs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>    
                <span class="n">Q</span><span class="p">(</span><span class="n">apellido__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>       
                <span class="n">Q</span><span class="p">(</span><span class="n">dni__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>           
        <span class="k">return</span> <span class="n">qs</span></div>
</div>

    
<div class="viewcode-block" id="DocenteAutocomplete">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.DocenteAutocomplete">[documentos]</a>
<span class="k">class</span> <span class="nc">DocenteAutocomplete</span><span class="p">(</span><span class="n">autocomplete</span><span class="o">.</span><span class="n">Select2QuerySetView</span><span class="p">):</span>
<div class="viewcode-block" id="DocenteAutocomplete.get_queryset">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.DocenteAutocomplete.get_queryset">[documentos]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ENTRE A AUTOCOMPLETE******&#39;</span><span class="p">)</span>
        <span class="n">fecha_actual</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="c1"># Filtra los estudiantes que no están inscritos en el ciclo actual</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">Docente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1">#qs = Estudiante.objects.all()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entreee&quot;</span><span class="p">,</span><span class="n">qs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>    
                <span class="n">Q</span><span class="p">(</span><span class="n">apellido__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span>       
                <span class="n">Q</span><span class="p">(</span><span class="n">dni__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>           
        <span class="k">return</span> <span class="n">qs</span></div>
</div>

    


<span class="c1">##################################################################</span>
<div class="viewcode-block" id="importar">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.importar">[documentos]</a>
<span class="k">def</span> <span class="nf">importar</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Llegué a importar&quot;</span><span class="p">)</span>
    <span class="n">resultado</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">localidades_creadas</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">localidades_fallidas</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">localidad_resource</span> <span class="o">=</span> <span class="n">LocalidadResource</span><span class="p">()</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">()</span>
        
        <span class="n">nuevas_localidades</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlsfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nuevas_localidades</span><span class="p">:</span>
            <span class="c1"># Verificar si el archivo ya ha sido importado en esta sesión</span>
            <span class="k">if</span> <span class="s1">&#39;archivo_importado&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
                <span class="n">imported_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nuevas_localidades</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">resultado</span> <span class="o">=</span> <span class="n">localidad_resource</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">resultado</span><span class="o">.</span><span class="n">has_errors</span><span class="p">():</span>
                        <span class="n">localidades_creadas</span> <span class="o">=</span> <span class="n">localidad_resource</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Se crearon </span><span class="si">{</span><span class="n">localidades_creadas</span><span class="si">}</span><span class="s1"> localidades exitosamente.&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">localidades_fallidas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultado</span><span class="o">.</span><span class="n">invalid_rows</span><span class="p">)</span>
                        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Error durante la importación. Se crearon </span><span class="si">{</span><span class="n">localidades_creadas</span><span class="si">}</span><span class="s1"> localidades y fallaron </span><span class="si">{</span><span class="n">localidades_fallidas</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                    
                    <span class="c1"># Registrar el archivo como importado en la sesión</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;archivo_importado&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Error durante la importación: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Este archivo ya ha sido importado previamente en esta sesión.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se ha proporcionado ningún archivo para importar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/importar.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;resultado&#39;</span><span class="p">:</span> <span class="n">resultado</span><span class="p">})</span></div>

<span class="c1">##################################################################</span>
<div class="viewcode-block" id="localidadView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.localidadView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">localidadView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">LocalidadForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;La localidad se creó correctamente.&#39;</span><span class="p">)</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="s2">&quot;Se dio de alta la localidad correctamente&quot;</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/localidad/ver&quot;</span><span class="p">,{</span><span class="s1">&#39;mesaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">LocalidadForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/LocalidadForm.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="localidadList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.localidadList">[documentos]</a>
<span class="k">def</span> <span class="nf">localidadList</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">localidades</span> <span class="o">=</span> <span class="n">Localidad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/verLocalidad.html&#39;</span><span class="p">,{</span><span class="s1">&#39;localidades&#39;</span><span class="p">:</span> <span class="n">localidades</span><span class="p">})</span></div>



<div class="viewcode-block" id="localidadEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.localidadEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">localidadEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_localidad</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">localidad</span> <span class="o">=</span> <span class="n">Localidad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_localidad</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">LocalidadForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span> <span class="n">localidad</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">LocalidadForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span> <span class="n">localidad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;La localidad se editó correctamente.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/localidad/ver&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/LocalidadForm.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>



<div class="viewcode-block" id="eliminarLocalidad">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarLocalidad">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarLocalidad</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idLocalidad</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">localidad</span> <span class="o">=</span> <span class="n">Localidad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idLocalidad</span><span class="p">)</span>
        <span class="n">localidad</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s2">&quot;Localidad eliminada correctamente&quot;</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;La localidad se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró la localidad que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/localidad/ver&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;mensaje&#39;</span><span class="p">:</span> <span class="n">mensaje</span><span class="p">})</span></div>




<span class="c1">######################ESTUDIANTE DOCENTE##################################################</span>
<div class="viewcode-block" id="estudianteView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.estudianteView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">estudianteView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EstudianteForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El estudiante se creó correctamente.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/estudiante/ver&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EstudianteForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/EstudianteForm.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="docenteView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.docenteView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">docenteView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DocenteForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creado docente&quot;</span><span class="p">)</span>
            <span class="n">nuevo_docente</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># Crear un nuevo usuario asociado al docente</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">nuevo_docente</span><span class="o">.</span><span class="n">dni</span>  <span class="c1"># Utiliza el DNI como nombre de usuario</span>
            <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;Clave2024#&#39;</span>  <span class="c1"># Genera una contraseña aleatoria</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">nuevo_docente</span><span class="o">.</span><span class="n">email</span>
            <span class="c1"># Crear el nuevo usuario</span>

            <span class="n">nuevo_usuario</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>

            <span class="c1"># Asociar el usuario al docente</span>
            <span class="n">nuevo_docente</span><span class="o">.</span><span class="n">usuario</span> <span class="o">=</span> <span class="n">nuevo_usuario</span>
            <span class="n">nuevo_docente</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se creo correctamente el docente usuario: &#39;</span><span class="o">+</span> <span class="n">username</span> <span class="o">+</span><span class="s1">&#39; contraseña: &#39;</span><span class="o">+</span> <span class="n">password</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/docente/ver&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DocenteForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/DocenteForm.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<span class="c1">################################################</span>
<div class="viewcode-block" id="inscripcionDeDocenteCiclo">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.inscripcionDeDocenteCiclo">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">inscripcionDeDocenteCiclo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_ciclo</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">id_ciclo_actual</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ciclo</span>
    <span class="n">inscriptos</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">id_ciclo_actual</span> <span class="k">else</span> <span class="n">InscripcionDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ciclo</span><span class="o">=</span><span class="n">id_ciclo_actual</span><span class="p">)</span>
    <span class="n">cant_inscriptos</span> <span class="o">=</span> <span class="n">inscriptos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entre a inscripcion docente&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">inscripcionDocenteForm</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">inscripcionDocenteForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;docente&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ciclo&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anio&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plan&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Era valido y se guardo bien&quot;</span><span class="p">)</span>
            <span class="n">correcto</span> <span class="o">=</span> <span class="s1">&#39;Docente Inscripto correctamente&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/inscripcionesDocente.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                                                                       <span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">id_ciclo_actual</span><span class="p">,</span>
                                                                       <span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">inscriptos</span><span class="p">,</span>
                                                                       <span class="s1">&#39;cant_inscriptos&#39;</span><span class="p">:</span> <span class="n">cant_inscriptos</span><span class="p">,</span>
                                                                       <span class="s1">&#39;correcto&#39;</span><span class="p">:</span> <span class="n">correcto</span>
                                                                       <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">as_data</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">error_list</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># field contiene el nombre del campo con error</span>
        <span class="c1"># error_list contiene una lista de errores para ese campo</span>
                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_list</span><span class="p">:</span>
            <span class="c1"># Muestra cada error en el campo</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error en el campo </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/inscripcionesDocente.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                                                               <span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">inscriptos</span><span class="p">,</span>
                                                               <span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">id_ciclo_actual</span><span class="p">})</span></div>


<span class="c1">############################                                                               </span>
<div class="viewcode-block" id="docenteList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.docenteList">[documentos]</a>
<span class="k">class</span> <span class="nc">docenteList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Docente</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;Core/Persona/verDocente.html&#39;</span></div>

<div class="viewcode-block" id="docenteEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.docenteEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">docenteEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">):</span>
    <span class="n">docente</span> <span class="o">=</span> <span class="n">Docente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DocenteEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span> <span class="n">docente</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DocenteEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span> <span class="n">docente</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El docente se editó correctamente.&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/docente/ver&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/DocenteForm.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="eliminarDocente">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarDocente">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarDocente</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">docente</span><span class="o">=</span> <span class="n">Docente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
        <span class="n">docente</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El docente se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Docente</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el docente que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/docente/ver&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="eliminarEstudiante">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarEstudiante">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarEstudiante</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_estudiante</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">estudiante</span> <span class="o">=</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_estudiante</span><span class="p">)</span>
        <span class="n">estudiante</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El estudiante se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el estudiante que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/estudiante/ver&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="eliminarInscripcion">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarInscripcion">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarInscripcion</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_estudiante</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">inscripcion</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">estudiante_id</span><span class="o">=</span><span class="n">id_estudiante</span><span class="p">)</span>
        <span class="n">inscripcion</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El estudiante se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el estudiante que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/estudiante/inscripcion&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;correcto&#39;</span><span class="p">,</span> <span class="s1">&#39;Se elimino la inscripcion del alumno&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="eliminarInscripcionDocente">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarInscripcionDocente">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarInscripcionDocente</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">,</span><span class="n">id_anio</span><span class="p">,</span><span class="n">id_ciclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">inscripcion</span> <span class="o">=</span> <span class="n">InscripcionDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">docente_id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">,</span><span class="n">anio_id</span><span class="o">=</span> <span class="n">id_anio</span><span class="p">,</span><span class="n">ciclo_id</span><span class="o">=</span> <span class="n">id_ciclo</span><span class="p">)</span>
        <span class="n">inscripcion</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El docente se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Docente</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el estudiante que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/docente/inscripcion&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;correcto&#39;</span><span class="p">,</span> <span class="s1">&#39;Se elimino la inscripcion del alumno&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="estudianteEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.estudianteEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">estudianteEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_estudiante</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">estudiante</span> <span class="o">=</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_estudiante</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EstudianteForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span> <span class="n">estudiante</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EstudianteForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span> <span class="n">estudiante</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El estudiante se modificó correctamente.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/estudiante/ver&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/EstudianteForm.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">})</span></div>



<div class="viewcode-block" id="estudianteList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.estudianteList">[documentos]</a>
<span class="k">class</span> <span class="nc">estudianteList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Estudiante</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;Core/Persona/verEstudiante.html&#39;</span></div>




<span class="c1">################PLAN##################################</span>

<div class="viewcode-block" id="planDeEstudiosView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.planDeEstudiosView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">planDeEstudiosView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PlanDeEstudiosForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
           <span class="n">plan</span><span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
           <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se creo el plan de estudios y los años correctamente&#39;</span><span class="p">)</span>
           <span class="n">plan</span><span class="o">.</span><span class="n">crear_anios_plan</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PlanDeEstudiosForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/PlanDeEstudios.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="planList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.planList">[documentos]</a>
<span class="nd">@login_required</span>    
<span class="k">def</span> <span class="nf">planList</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">=</span><span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-esActual&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">planes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verPlan.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;planes&#39;</span><span class="p">:</span> <span class="n">planes</span><span class="p">,</span>
    <span class="p">})</span>    </div>


<div class="viewcode-block" id="planDetalle">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.planDetalle">[documentos]</a>
<span class="nd">@login_required</span>    
<span class="k">def</span> <span class="nf">planDetalle</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">id_plan</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">plan</span><span class="o">=</span><span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">id_plan</span><span class="p">)</span>
    <span class="n">cantidadAnios</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">cantidadAnios</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">plan</span><span class="o">.</span><span class="n">cantidadAnios</span><span class="p">))</span>
    <span class="n">espaciosCurriculares</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;anio&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verDetallePlan.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;plan&#39;</span><span class="p">:</span> <span class="n">plan</span><span class="p">,</span>
        <span class="s1">&#39;espaciosCurriculares&#39;</span> <span class="p">:</span> <span class="n">espaciosCurriculares</span><span class="p">,</span>
        <span class="s1">&#39;cantidadAnios&#39;</span><span class="p">:</span> <span class="n">cantidadAnios</span><span class="p">,</span>
    <span class="p">})</span>    </div>


<div class="viewcode-block" id="planEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.planEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">planEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_plan</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_plan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PlanDeEstudiosEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">PlanDeEstudiosEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se edito el plan correctamente.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/PlanDeEstudios.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">})</span></div>


<span class="k">def</span> <span class="nf">cambiarActual</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_plan</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="c1"># Llama al método cambiar_actual de la clase PlanDeEstudios</span>
    <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">cambiar_actual</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_plan</span><span class="p">)</span>

    <span class="c1"># Redirige a la página deseada después de realizar el cambio</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span>
<span class="c1">#########################################################################</span>

<div class="viewcode-block" id="espacioView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.espacioView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">espacioView</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="c1">#id = 1</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    
    <span class="n">espacios</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EspacioCurricularForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">id_plan</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;guardando datoss&quot;</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se creo el espacio curricular correctamente.&#39;</span><span class="p">)</span>
            <span class="n">espacios</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="p">)</span>
            <span class="c1">#return HttpResponseRedirect(&quot;/Core/EspacioCurricular/EspaciosCurricularesForm.html&quot;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EspacioCurricularForm</span><span class="p">(</span><span class="n">id_plan</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;retornando formiulariox&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/EspacioCurricular/EspaciosCurricularesForm.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s1">&#39;plan&#39;</span><span class="p">:</span> <span class="n">plan</span><span class="p">,</span>
        <span class="s1">&#39;espacios&#39;</span><span class="p">:</span> <span class="n">espacios</span><span class="p">})</span></div>



<div class="viewcode-block" id="espacioEliminar">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.espacioEliminar">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">espacioEliminar</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_espacio</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">espacio</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_espacio</span><span class="p">)</span>
        <span class="n">plan_id</span> <span class="o">=</span> <span class="n">espacio</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span>  <span class="c1"># Obtener el ID del plan antes de eliminar el espacio</span>
        <span class="n">espacio</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El espacio curricular se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el Ciclo que intentas eliminar.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Core/espacio/verEnPlan/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/Core/espacio/verEnPlan/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plan_id</span><span class="p">))</span></div>


<span class="c1">#    return HttpResponseRedirect(&quot;/Core/plan/ver&quot;)</span>

<span class="c1">###################################</span>
<span class="c1">###################################</span>
<div class="viewcode-block" id="espacioEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.espacioEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">espacioEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_espacio</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">espacio</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_espacio</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;entre acaaa&#39;</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EspacioCurricularEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span> <span class="n">espacio</span><span class="p">,</span><span class="n">id_plan</span><span class="o">=</span><span class="n">espacio</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EspacioCurricularEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span> <span class="n">espacio</span><span class="p">,</span><span class="n">id_plan</span><span class="o">=</span><span class="n">espacio</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se edito el espacio curricular correctamente.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/Core/espacio/verEnPlan/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">espacio</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/EspacioCurricular/EspaciosCurricularesForm.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">})</span></div>


<div class="viewcode-block" id="menuPlan">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.menuPlan">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">menuPlan</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/menuPlan.html&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="menuDocente">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.menuDocente">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">menuDocente</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usuariooooo:&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
    <span class="n">dni</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
    <span class="n">docente</span> <span class="o">=</span> <span class="n">Docente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dni</span> <span class="o">=</span> <span class="n">dni</span><span class="p">)</span>
    <span class="n">inscripciones</span> <span class="o">=</span> <span class="n">InscripcionDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">docente</span> <span class="o">=</span> <span class="n">docente</span><span class="p">,</span> <span class="n">ciclo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ciclo</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inscripciones</span><span class="p">)</span>
    <span class="n">anios</span> <span class="o">=</span> <span class="n">inscripciones</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;anio&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">divisiones</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio__in</span><span class="o">=</span><span class="n">anios</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">ciclo</span><span class="p">)</span>
    <span class="n">horarios</span> <span class="o">=</span> <span class="n">Detalle_Horario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">docente</span> <span class="o">=</span> <span class="n">docente</span><span class="p">,</span><span class="n">horario__division__in</span><span class="o">=</span><span class="n">divisiones</span><span class="p">)</span>
    <span class="n">horarios</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">horarios</span><span class="p">))</span>
    
    <span class="n">aulas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hora</span> <span class="ow">in</span> <span class="n">horarios</span><span class="p">:</span>
        <span class="n">aulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hora</span><span class="o">.</span><span class="n">horario</span><span class="p">)</span>
    <span class="n">aulas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aulas</span><span class="p">))</span>
    <span class="n">dias</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tupla</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">tupla</span> <span class="ow">in</span> <span class="n">Horario</span><span class="o">.</span><span class="n">CHOICES_DIA</span><span class="p">]</span>
    <span class="n">modulos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tupla</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">tupla</span> <span class="ow">in</span> <span class="n">Horario</span><span class="o">.</span><span class="n">CHOICES_HORA</span><span class="p">]</span>  
    <span class="n">instancia</span> <span class="o">=</span> <span class="n">Instancia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">disponible</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span><span class="p">)</span>  

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/menuDocente.html&#39;</span><span class="p">,{</span> <span class="s1">&#39;inscripciones&#39;</span><span class="p">:</span> <span class="n">inscripciones</span><span class="p">,</span>
                                                            <span class="s1">&#39;aulas&#39;</span><span class="p">:</span> <span class="n">aulas</span><span class="p">,</span>
                                                           <span class="s1">&#39;horarios&#39;</span> <span class="p">:</span> <span class="n">horarios</span><span class="p">,</span>
                                                           <span class="s1">&#39;modulos&#39;</span><span class="p">:</span> <span class="n">modulos</span><span class="p">,</span>
                                                           <span class="s1">&#39;dias&#39;</span><span class="p">:</span> <span class="n">dias</span><span class="p">,</span>
                                                           <span class="s1">&#39;instancia&#39;</span><span class="p">:</span> <span class="n">instancia</span><span class="p">})</span></div>

    
<div class="viewcode-block" id="menuCiclo">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.menuCiclo">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">menuCiclo</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">hay_ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ciclo_activo =  Ciclo.objects.get(esActual=&#39;True&#39;).fechaInicio &lt;= timezone.now().date() &gt;= Ciclo.objects.get(esActual=&#39;True&#39;).fechaInicio</span>
        <span class="n">ciclo_activo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ciclo</span>
    <span class="k">except</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">ciclo_activo</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ciclo&#39;</span><span class="p">,</span><span class="n">ciclo_activo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/menuCiclo.html&#39;</span><span class="p">,{</span><span class="s1">&#39;cicloActivo&#39;</span><span class="p">:</span><span class="n">ciclo_activo</span><span class="p">})</span></div>


<div class="viewcode-block" id="eliminarCiclo">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarCiclo">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarCiclo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idCiclo</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Q</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idCiclo</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
            <span class="n">plan</span> <span class="o">=</span> <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">plan</span><span class="o">.</span><span class="n">implementado</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span> 
            <span class="n">plan</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Se elimino el ciclo correctamente.&#39;</span><span class="p">)</span>
        <span class="n">ciclo</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El Ciclo se eliminó correctamente.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;No se encontró el Ciclo que intentas eliminar.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="aniosDePlanActual">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.aniosDePlanActual">[documentos]</a>
<span class="k">def</span> <span class="nf">aniosDePlanActual</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ciclo</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ciclo&quot;</span><span class="p">,</span> <span class="n">ciclo</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">,</span><span class="n">plan</span><span class="p">)</span>
    <span class="n">anios</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/aniosActuales.html&#39;</span><span class="p">,{</span><span class="s1">&#39;anios&#39;</span><span class="p">:</span><span class="n">anios</span><span class="p">,</span>
                                                            <span class="s1">&#39;ciclo&#39;</span><span class="p">:</span><span class="n">ciclo</span><span class="p">})</span></div>



<div class="viewcode-block" id="espacioList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.espacioList">[documentos]</a>
<span class="k">class</span> <span class="nc">espacioList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">EspacioCurricular</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;Core/EspacioCurricular/verEspacios.html&#39;</span></div>


<div class="viewcode-block" id="cargarEspacios">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cargarEspacios">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cargarEspacios</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">anioPlan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anio&#39;</span><span class="p">)</span>
    <span class="n">espacios</span> <span class="o">=</span> <span class="n">EspacioCurricular</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio_id</span><span class="o">=</span><span class="n">anioPlan</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">anioPlan</span><span class="p">,</span><span class="n">espacios</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Cursada/opciones_espacios.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;espacios&#39;</span><span class="p">:</span> <span class="n">espacios</span><span class="p">})</span></div>


<span class="c1">########## ESTOY ACA #################</span>
<div class="viewcode-block" id="anioList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.anioList">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">anioList</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;llegue&quot;</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">ciclo</span><span class="p">))</span>
    <span class="n">anioPlan</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">anioPlan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verAnio.html&#39;</span><span class="p">,{</span><span class="s1">&#39;anioPlan&#39;</span><span class="p">:</span> <span class="n">anioPlan</span><span class="p">,</span>
                                                     <span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">ciclo</span><span class="o">.</span><span class="n">id</span><span class="p">})</span></div>


<div class="viewcode-block" id="anioListActual">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.anioListActual">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">anioListActual</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ciclo</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">ciclo</span><span class="p">))</span>
    <span class="n">anioPlan</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">anioPlan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verAnio.html&#39;</span><span class="p">,{</span><span class="s1">&#39;anioPlan&#39;</span><span class="p">:</span> <span class="n">anioPlan</span><span class="p">,</span>
                                                     <span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">ciclo</span><span class="o">.</span><span class="n">id</span><span class="p">})</span></div>

<div class="viewcode-block" id="cicloList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cicloList">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cicloList</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VER CICLO Estoy aca&quot;</span><span class="p">)</span>
    <span class="n">anioCicloPlan</span><span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span> <span class="nb">id</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">anioCicloPlan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verCiclo.html&#39;</span><span class="p">,{</span><span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">anioCicloPlan</span><span class="p">,</span>
                                                      <span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="nb">id</span><span class="p">})</span>    </div>


<span class="c1">######ESTOY ACA####</span>
<div class="viewcode-block" id="cicloPlanList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cicloPlanList">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cicloPlanList</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VER CICLO estoy aca&quot;</span><span class="p">,</span> <span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">anioCicloPlan</span><span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-esActual&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verCiclo.html&#39;</span><span class="p">,{</span><span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">anioCicloPlan</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;plan&#39;</span><span class="p">:</span><span class="n">plan</span> <span class="p">})</span>    </div>



<div class="viewcode-block" id="cicloView">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cicloView">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cicloView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;entre acaaaaa&#39;</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">PlanDeEstudios</span><span class="p">,</span> <span class="n">esActual</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
    <span class="n">anios</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CicloForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="k">else</span> <span class="n">forms</span><span class="o">.</span><span class="n">CicloForm</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entre aca era valido&quot;</span><span class="p">)</span>
        <span class="n">ciclo</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El ciclo se creó correctamente.&#39;</span><span class="p">)</span>
        <span class="n">ciclo</span><span class="o">.</span><span class="n">crear_division_para_anio_ciclo</span><span class="p">(</span><span class="n">ciclo</span><span class="p">,</span> <span class="n">anios</span><span class="p">)</span>
        <span class="n">Ciclo</span><span class="o">.</span><span class="n">cambiar_actual</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">plan</span><span class="o">.</span><span class="n">implementado</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plan</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/Core/ciclo/verEnPlan/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/CicloForm.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;plan&#39;</span><span class="p">:</span> <span class="n">plan</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span></div>


<div class="viewcode-block" id="cambiarActual">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cambiarActual">[documentos]</a>
<span class="k">def</span> <span class="nf">cambiarActual</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_plan</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="c1"># Llama al método cambiar_actual de la clase PlanDeEstudios</span>
    <span class="n">PlanDeEstudios</span><span class="o">.</span><span class="n">cambiar_actual</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_plan</span><span class="p">)</span>

    <span class="c1"># Redirige a la página deseada después de realizar el cambio</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="cicloEdit">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.cicloEdit">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cicloEdit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_ciclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_ciclo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CicloEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">ciclo</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CicloEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span> <span class="n">ciclo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El ciclo se editó correctamente.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Core/plan/ver&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/CicloForm.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></div>


<span class="c1">################################################</span>
<div class="viewcode-block" id="eliminarDivision">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.eliminarDivision">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">eliminarDivision</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="n">division</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">idCiclo</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">division</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">aula</span> <span class="o">=</span> <span class="n">Aula</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">division</span><span class="o">=</span><span class="n">division</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">division</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">aula</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Division eliminada correctamente&#39;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Debe existir al menos una división&#39;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>

    <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">idCiclo</span><span class="p">))</span>
    <span class="n">alumnos</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="n">anio</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verDivision.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;divisiones&#39;</span><span class="p">:</span> <span class="n">division</span><span class="p">,</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">idCiclo</span><span class="p">,</span>
        <span class="s1">&#39;anio&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
        <span class="s1">&#39;cant_alumnos&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">alumnos</span><span class="p">),</span>
    <span class="p">})</span></div>


<div class="viewcode-block" id="divisionList">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.divisionList">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">divisionList</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="n">idCiclo</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo</span><span class="p">)</span>
    <span class="n">alumnos</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="n">anio</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verDivision.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;divisiones&#39;</span><span class="p">:</span> <span class="n">division</span><span class="p">,</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">idCiclo</span><span class="p">,</span>
        <span class="s1">&#39;anio&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
        <span class="s1">&#39;cant_alumnos&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">alumnos</span><span class="p">),</span>
        <span class="s1">&#39;cant_divisiones&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">division</span><span class="p">),</span>
        <span class="s1">&#39;mensaje&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">})</span></div>


<div class="viewcode-block" id="crearDivision">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.crearDivision">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">crearDivision</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">anio</span> <span class="o">=</span> <span class="n">AnioPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">ciclo</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="n">division</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">idCiclo</span><span class="p">))</span>
        <span class="n">codigo</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">division</span><span class="p">)]</span>
        <span class="n">descripcion</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">anio</span><span class="o">.</span><span class="n">codigo</span><span class="si">}</span><span class="s2">, Año Division </span><span class="si">{</span><span class="n">codigo</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">nueva_division</span> <span class="o">=</span> <span class="n">Division</span><span class="p">(</span><span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo</span><span class="p">,</span> <span class="n">codigo</span><span class="o">=</span><span class="n">codigo</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">,</span> <span class="n">anio</span><span class="o">=</span><span class="n">anio</span><span class="p">)</span>
        <span class="n">nueva_division</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">Aula</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">division</span><span class="o">=</span><span class="n">nueva_division</span><span class="p">)</span>
        <span class="n">nueva_division</span><span class="o">.</span><span class="n">crear_Horario_Division</span><span class="p">()</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;division&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;anio&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;codigo&#39;</span><span class="p">:</span> <span class="n">anio</span><span class="o">.</span><span class="n">codigo</span><span class="p">},</span>
                <span class="s1">&#39;codigo&#39;</span><span class="p">:</span> <span class="n">nueva_division</span><span class="o">.</span><span class="n">codigo</span><span class="p">,</span>
                <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">nueva_division</span><span class="o">.</span><span class="n">descripcion</span><span class="p">,</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">nueva_division</span><span class="o">.</span><span class="n">id</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Division creada correctamente&#39;</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="verDivisionInasistencia">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.verDivisionInasistencia">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">verDivisionInasistencia</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span><span class="n">idCiclo</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VER Division&quot;</span><span class="p">)</span>
    <span class="n">division</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span><span class="n">ciclo</span> <span class="o">=</span> <span class="n">idCiclo</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VER Division2&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">division</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Plan/verDivisionInasistencia.html&#39;</span><span class="p">,{</span><span class="s1">&#39;divisiones&#39;</span><span class="p">:</span> <span class="n">division</span><span class="p">,</span>
                                                      <span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="nb">id</span><span class="p">,</span>
                                                      <span class="s1">&#39;anio&#39;</span><span class="p">:</span><span class="n">division</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">anio</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                      <span class="p">})</span>  </div>

<span class="c1">################################################</span>
<div class="viewcode-block" id="inscripcionDeEstudianteCiclo">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.inscripcionDeEstudianteCiclo">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">inscripcionDeEstudianteCiclo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_ciclo</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">id_ciclo_actual</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">inscriptos</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">id_ciclo_actual</span> <span class="k">else</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ciclo</span><span class="o">=</span><span class="n">id_ciclo_actual</span><span class="p">)</span>
    <span class="n">cant_inscriptos</span> <span class="o">=</span> <span class="n">inscriptos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">inscripcionAlumnoForm</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">inscripcionAlumnoForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="n">estudiante</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;estudiante&#39;</span><span class="p">)</span>
        <span class="n">fecha</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fecha&#39;</span><span class="p">)</span>
        <span class="n">cicloid</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ciclo&#39;</span><span class="p">)</span>
        <span class="n">anio</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;anio&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            
            <span class="n">correcto</span> <span class="o">=</span> <span class="s1">&#39;Alumno Inscripto correctamente&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/Inscripciones.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                                                                       <span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">id_ciclo_actual</span><span class="p">,</span>
                                                                       <span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">inscriptos</span><span class="p">,</span>
                                                                       <span class="s1">&#39;cant_inscriptos&#39;</span><span class="p">:</span> <span class="n">cant_inscriptos</span><span class="p">,</span>
                                                                       <span class="s1">&#39;correcto&#39;</span><span class="p">:</span> <span class="n">correcto</span>
                                                                       <span class="p">})</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/Inscripciones.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                                                               <span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">inscriptos</span><span class="p">,</span>
                                                               <span class="s1">&#39;ciclo&#39;</span><span class="p">:</span> <span class="n">id_ciclo_actual</span><span class="p">})</span></div>

<div class="viewcode-block" id="estudiantesDeAnioEnCiclo">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.estudiantesDeAnioEnCiclo">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">estudiantesDeAnioEnCiclo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="n">estudiantesCiclo</span><span class="o">=</span>  <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ciclo</span> <span class="o">=</span> <span class="n">idCiclo</span><span class="p">)</span>   
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Core/Persona/estudiantes_por_anio_ciclo.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;estudiantes&#39;</span><span class="p">:</span> <span class="n">estudiantesCiclo</span><span class="p">})</span></div>


<div class="viewcode-block" id="listEstudianteAula">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.listEstudianteAula">[documentos]</a>
<span class="k">def</span> <span class="nf">listEstudianteAula</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">idDivision</span><span class="p">):</span>
    <span class="n">aula</span> <span class="o">=</span> <span class="n">Aula</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">division_id</span><span class="o">=</span><span class="n">idDivision</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idDivision</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Cursada/cargarInasistencia.html&#39;</span><span class="p">,{</span><span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">aula</span><span class="o">.</span><span class="n">estudiantes</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span>
                                                                 <span class="s1">&#39;division&#39;</span><span class="p">:</span> <span class="n">division</span><span class="p">})</span></div>


<div class="viewcode-block" id="corregirInasistenciaAula">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.corregirInasistenciaAula">[documentos]</a>
<span class="k">def</span> <span class="nf">corregirInasistenciaAula</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">idDivision</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;llegue acaaa&quot;</span><span class="p">)</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">aula</span> <span class="o">=</span> <span class="n">Aula</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">division_id</span><span class="o">=</span><span class="n">idDivision</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idDivision</span><span class="p">)</span>
    <span class="n">inasistencias_hoy</span> <span class="o">=</span> <span class="n">Inasistencias</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dia</span><span class="o">=</span><span class="n">today</span><span class="p">,</span> <span class="n">estudiante__in</span><span class="o">=</span><span class="n">aula</span><span class="o">.</span><span class="n">estudiantes</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="c1">#inasistencias_hoy = Inasistencias.objects.filter(dia=today, estudiante__division_id=idDivision)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Cursada/corregirInasistencia.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;inasistencias_hoy&#39;</span><span class="p">:</span> <span class="n">inasistencias_hoy</span><span class="p">,</span>
                                                                 <span class="s1">&#39;division&#39;</span><span class="p">:</span> <span class="n">division</span><span class="p">})</span></div>

    

<div class="viewcode-block" id="asignarEstudianteDivision">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.asignarEstudianteDivision">[documentos]</a>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">asignarEstudianteDivision</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">idAnio</span><span class="p">,</span> <span class="n">idCiclo</span><span class="p">):</span>
    <span class="n">inscriptos</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span> <span class="o">=</span> <span class="n">idAnio</span><span class="p">,</span> <span class="n">ciclo</span> <span class="o">=</span> <span class="n">idCiclo</span><span class="p">)</span>
    <span class="n">division</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span> <span class="o">=</span> <span class="n">idAnio</span><span class="p">,</span> <span class="n">ciclo</span> <span class="o">=</span> <span class="n">idCiclo</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">division</span><span class="p">)</span>
    <span class="n">cantidadAlumnosInscriptos</span> <span class="o">=</span> <span class="n">inscriptos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cantidad alumnos&quot;</span><span class="p">,</span> <span class="n">inscriptos</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cantidadAlumnosInscriptos</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">Division</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estoy en el Post&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
            <span class="n">alumno</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;El estudiante se asignó correctamente.&#39;</span><span class="p">)</span>
            <span class="c1">#division.estudiates.add(estudiante).</span>
            <span class="c1">#aula.alumnos.add(alumno)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;/Notas/verInasistencias&quot;</span><span class="p">)</span>

            <span class="c1">#return redirect(&#39;detalle_aula&#39;, aula_id=aula_id)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DivisionForm</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Cursada/cargarInasistencia.html&#39;</span><span class="p">,{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">inscriptos</span><span class="p">,</span>
                                                                 <span class="s1">&#39;cantAlumnos&#39;</span><span class="p">:</span> <span class="n">cantidadAlumnosInscriptos</span><span class="p">})</span></div>


<div class="viewcode-block" id="asignarEstudianteAula">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.asignarEstudianteAula">[documentos]</a>
<span class="k">def</span> <span class="nf">asignarEstudianteAula</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">id_anio</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>
    <span class="n">ciclo_actual</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">esActual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Obtener las divisiones del año y ciclo actual</span>
    <span class="n">divisiones</span> <span class="o">=</span> <span class="n">Division</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="n">id_anio</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo_actual</span><span class="p">)</span>

    <span class="c1"># Obtener los estudiantes inscritos al año y ciclo actual</span>
    <span class="n">estudiantes</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">anio</span><span class="o">=</span><span class="n">id_anio</span><span class="p">,</span> <span class="n">ciclo</span><span class="o">=</span><span class="n">ciclo_actual</span><span class="p">)</span>
    <span class="c1">#divisiones = Division.objects.filter(anio = id_anio,ciclo=1)</span>
    <span class="c1">#estudiantes = Inscripcion.objects.filter(anio = id_anio)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">estudiantes</span><span class="p">)</span>
    <span class="n">cantidadInscriptos</span> <span class="o">=</span><span class="n">estudiantes</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">cantidadDivisiones</span> <span class="o">=</span> <span class="n">divisiones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;Cursada/Aula.html&#39;</span><span class="p">,{</span><span class="s1">&#39;inscriptos&#39;</span><span class="p">:</span> <span class="n">estudiantes</span><span class="p">,</span>
                                                                 <span class="s1">&#39;cantAlumnos&#39;</span><span class="p">:</span> <span class="n">cantidadInscriptos</span><span class="p">,</span>
                                                                 <span class="s1">&#39;cantDivisiones&#39;</span><span class="p">:</span> <span class="n">cantidadDivisiones</span><span class="p">})</span></div>




<div class="viewcode-block" id="exportarHistorialPdf">
<a class="viewcode-back" href="../../modules/modules.html#Core.views.exportarHistorialPdf">[documentos]</a>
<span class="k">def</span> <span class="nf">exportarHistorialPdf</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">estudiante_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_staff</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s1">&#39;Acceso denegado.&#39;</span><span class="p">)</span>

    <span class="n">estudiante</span> <span class="o">=</span> <span class="n">Estudiante</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">estudiante_id</span><span class="p">)</span>
    <span class="n">inscripciones</span> <span class="o">=</span> <span class="n">Inscripcion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">estudiante</span><span class="o">=</span><span class="n">estudiante</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;fecha&#39;</span><span class="p">)</span>
    <span class="n">faltas</span> <span class="o">=</span> <span class="n">Inasistencias</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">estudiante</span><span class="o">=</span><span class="n">estudiante</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;dia&#39;</span><span class="p">)</span>
    <span class="n">calificaciones</span> <span class="o">=</span> <span class="n">Calificacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">estudiante</span><span class="o">=</span><span class="n">estudiante</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;ciclo&#39;</span><span class="p">,</span> <span class="s1">&#39;espacioCurricular&#39;</span><span class="p">)</span>

    <span class="c1"># Crear un buffer de bytes en memoria para el PDF</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="c1"># Crear el documento PDF</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">SimpleDocTemplate</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="n">letter</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Obtener los estilos de muestra de ReportLab</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="n">getSampleStyleSheet</span><span class="p">()</span>

    <span class="c1"># Encabezado</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Historial del Estudiante&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estudiante: </span><span class="si">{</span><span class="n">estudiante</span><span class="o">.</span><span class="n">nombre</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">estudiante</span><span class="o">.</span><span class="n">apellido</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fecha de alta: </span><span class="si">{</span><span class="n">estudiante</span><span class="o">.</span><span class="n">fechaInscripcion</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># Organizar las inscripciones por plan y ciclo</span>
    <span class="n">planes_ciclos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">inscripcion</span> <span class="ow">in</span> <span class="n">inscripciones</span><span class="p">:</span>
        <span class="n">plan_anio</span> <span class="o">=</span> <span class="n">inscripcion</span><span class="o">.</span><span class="n">ciclo</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">anio</span>
        <span class="n">ciclo_anio</span> <span class="o">=</span> <span class="n">inscripcion</span><span class="o">.</span><span class="n">ciclo</span><span class="o">.</span><span class="n">anioCalendario</span>
        <span class="k">if</span> <span class="n">plan_anio</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">planes_ciclos</span><span class="p">:</span>
            <span class="n">planes_ciclos</span><span class="p">[</span><span class="n">plan_anio</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ciclo_anio</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">planes_ciclos</span><span class="p">[</span><span class="n">plan_anio</span><span class="p">]:</span>
            <span class="n">planes_ciclos</span><span class="p">[</span><span class="n">plan_anio</span><span class="p">][</span><span class="n">ciclo_anio</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">planes_ciclos</span><span class="p">[</span><span class="n">plan_anio</span><span class="p">][</span><span class="n">ciclo_anio</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inscripcion</span><span class="p">)</span>

    <span class="c1"># Datos del historial</span>
    <span class="k">for</span> <span class="n">plan_anio</span><span class="p">,</span> <span class="n">ciclos</span> <span class="ow">in</span> <span class="n">planes_ciclos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plan de Estudio: </span><span class="si">{</span><span class="n">plan_anio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">ciclo_anio</span><span class="p">,</span> <span class="n">inscripciones_ciclo</span> <span class="ow">in</span> <span class="n">ciclos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ciclo: </span><span class="si">{</span><span class="n">ciclo_anio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2&#39;</span><span class="p">]))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Año&quot;</span><span class="p">,</span> <span class="s2">&quot;Fecha de Inscripción&quot;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">inscripcion</span> <span class="ow">in</span> <span class="n">inscripciones_ciclo</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                    <span class="n">inscripcion</span><span class="o">.</span><span class="n">anio</span><span class="p">,</span>
                    <span class="n">inscripcion</span><span class="o">.</span><span class="n">fecha</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y&quot;</span><span class="p">)</span>
                <span class="p">])</span>
            
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;TEXTCOLOR&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">whitesmoke</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;BOTTOMPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">12</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
            <span class="p">]))</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

            <span class="c1"># Calificaciones para el ciclo actual</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calificaciones del Ciclo: </span><span class="si">{</span><span class="n">ciclo_anio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading3&#39;</span><span class="p">]))</span>
            <span class="n">calificaciones_ciclo</span> <span class="o">=</span> <span class="n">calificaciones</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ciclo__anioCalendario</span><span class="o">=</span><span class="n">ciclo_anio</span><span class="p">)</span>
            <span class="n">calificaciones_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Espacio Curricular&quot;</span><span class="p">,</span> <span class="s2">&quot;Nota&quot;</span><span class="p">,</span> <span class="s2">&quot;Docente&quot;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">calificacion</span> <span class="ow">in</span> <span class="n">calificaciones_ciclo</span><span class="p">:</span>
                <span class="n">calificaciones_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                    <span class="n">calificacion</span><span class="o">.</span><span class="n">espacioCurricular</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
                    <span class="n">calificacion</span><span class="o">.</span><span class="n">nota</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">calificacion</span><span class="o">.</span><span class="n">docente</span><span class="o">.</span><span class="n">nombre</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">calificacion</span><span class="o">.</span><span class="n">docente</span><span class="o">.</span><span class="n">apellido</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">])</span>
            
            <span class="n">table_calificaciones</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">calificaciones_data</span><span class="p">)</span>
            <span class="n">table_calificaciones</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;TEXTCOLOR&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">whitesmoke</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;BOTTOMPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">12</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
            <span class="p">]))</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_calificaciones</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># Datos de inasistencias</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Inasistencias&quot;</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">]))</span>
    <span class="n">inasistencias_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">,</span> <span class="s1">&#39;Justificada?&#39;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">falta</span> <span class="ow">in</span> <span class="n">faltas</span><span class="p">:</span>
        <span class="n">justificada</span> <span class="o">=</span> <span class="s1">&#39;SI&#39;</span> <span class="k">if</span> <span class="n">falta</span><span class="o">.</span><span class="n">justificacion</span> <span class="k">else</span> <span class="s1">&#39;NO&#39;</span>
        <span class="n">inasistencias_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
            <span class="n">falta</span><span class="o">.</span><span class="n">dia</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y&quot;</span><span class="p">),</span>
            <span class="n">justificada</span>
        <span class="p">])</span>
    
    <span class="n">table_inasistencias</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">inasistencias_data</span><span class="p">)</span>
    <span class="n">table_inasistencias</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;TEXTCOLOR&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">whitesmoke</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;BOTTOMPADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
    <span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_inasistencias</span><span class="p">)</span>

    <span class="c1"># Construir el PDF</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Devolver el PDF como una respuesta HTTP</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;historial_estudiante_</span><span class="si">{</span><span class="n">estudiante_id</span><span class="si">}</span><span class="s1">.pdf&quot;&#39;</span>
    <span class="k">return</span> <span class="n">response</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Sge - 1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Core.views</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Jonathan Torres.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>